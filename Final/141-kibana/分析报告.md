# Kibana 分析报告

## 小组分工

张翔宇：负责数据处理部分的运行与撰写。

伍泰炜：负责报告的整理与撰写。

## 项目简介

Kibana 是一个基于 Node.js 的 Elasticsearch 索引库数据统计工具，也正是 Elastic 公司旗下的业务线之一。2018 年 10 月 5 日上午 9:30，纽约证券交易所的铃声响起时，Elastic 正式成为一家上市公司。

它在 Elasticsearch 集群上索引的内容之上提供可视化功能。它利用 Elasticsearch 的聚合功能，生成各种图表，如柱形图，线状图，饼图等等；而且还提供了操作 Elasticsearch 索引数据的控制台，并且提供了一定的 API 提示。Kibana 还提供了一个被称为 Canvas 的演示工具，允许用户创建幻灯片，直接从 Elasticsearch 中获取实时数据。Elasticsearch、Logstash 和 Kibana 的组合被称为 "Elastic Stack"（以前是 "ELK stack"），可作为产品或服务使用。Logstash 为 Elasticsearch 提供输入流，用于存储和搜索，Kibana 访问数据用于可视化，如仪表盘。Elastic 还提供 "Beats "包，可配置为提供有关各种数据库和应用技术的预制 Kibana 可视化和仪表盘。

2021 年 5 月，OpenSearch 发布了 OpenSearch Dashboards 的第一个测试版，这是在 Elastic 停止开源项目并转向专有软件开发后，由 Amazon Web Services 赞助的 Kibana 的 Apache 许可分支。

## 版本发布历史

Kibana 总计有八个大版本，项目早期他们的发版流程没有那么规范，特别是从 0-3 的四个版本，没有完整的 alpha-beta-rc 这样的流程，但是随着项目的发展，可能也是软件工程知识的普及，社区开始按照规范的方式发布大版本。

同样，初期的原型阶段没有完全遵循 semantic versioning 但是在第四个大版本之后越发严谨。

## 主要贡献者的构成

项目最开始由 [bleskes](https://github.com/bleskes) 于 2013 年下半年创建，他属于早期的维护者。后期不再有开发动态。

本项目从 2014 年开始就全面由 [spalger](https://github.com/spalger) 维护，可以看到他在此后的大多数时间段都占有最高的代码贡献。并且，他应该很快成为或者已经是 Elastic 公司的职员。

除了 spalger 之外的开发人员流动相当显著，但也非常合理，因为这是一个至今已经 6 年的项目，spalger 能维护这么久是一件非常不容易的事情。

特别是有两个时间点，一个是 2016 年底，有许多早期开发者开始离职，并且在这一整年，代码变更数量呈现持续降低的趋势，但是在次年马上吸引了新的开发者，进入下一个增长阶段；另一个是 2019 年底，在这一年有个别到中期对项目具有重大贡献的开发者离职，或者减少了贡献的数量，但同使社区迎来了大量新的开发者并且一直稳定贡献至今。这背后的原因可能就是 Elastic 公司在 2018 上市了，老员工可能发生了调整，并且吸引了大量新员工。

因为本项目是 elastic 公司主导的开源项目，主要由公司的员工作为核心开发者进行维护，所以贡献历史有很明显的工作交接的特征。比如从 2020 年开始的前八位贡献最多的开发者，目前都是 elastic 公司的在职员工。相对于一般开源项目，本项目的外部贡献的人次虽然多，但真正的代码量占比不那么大。

## CI/CD 的使用情况

本项目使用了 jenkins 和 GitHub Action 两种自动化流水线。其中 GitHub Action 的流水线多侧重于 GitHub 相关的功能，例如：

- 自动给 issue 打标签
- 修正 version gaps
- 自动化 project 标签
- 自动化 assign
- 自动测试是否可以编译

而 Jenkins 的流水线式多侧重于各类基准测试。

## 与PHPExcel的对比

由于phpexcel只是一个库，而kibana是一个成熟的app，所以在数值的对比上二者不具有可比性。

整体来看，kibana处于一个平稳发展阶段而phpexcel开发者数量不断减少。

特别注意的是，kibana在2018年8月份有一个很高的峰值，值得后续的研究。

从开发者数量来讲，phpexcel从archive开始就开始走下坡路了，直到0 

而cabana可以做到讲开发者数量维护在500-1000这个量级，这对于社区来说很重要。

Kibana社区其实还分叉出Grafana，后面补充了详细的说明。

结合这两个项目分析，我认为活跃的主要因素还是与需求（需要优秀的监控工具）和战略（将phpexcel移到别的苦中）有关。



## Kibana 与 Grafana 的对比

Kibana 和 Grafana 都是知名的日志监控工具，两者颇有渊源。通过 Github 的提交记录我们可以看出 Grafana 最早是 Kibana 3 的分支 ，所以用过 Kibana 3 的人会感觉到 Grafana 的界面风格和 Kibana3 的风格相当一致。

回顾 Kibana 的开发历史，2011 年 Rashid Khan 用 PHP 编写了 Kibana 1.0，发现开发过程不流畅，随即第二年用 Ruby 重写实现了 Kibana 2.0，但还是不满意。2013 年，他又用 AngularJS 再次重写。当时的 Kibana3 是一个纯前端 UI 的项目，但随着功能需求越来越复杂，遇到许多问题导致了开发瓶颈。比如，基于浏览器端没有办法保证数据传输安全，并且数据都要传输到浏览器端进行渲染，复杂的监控经常卡死浏览器，很多复杂的功能需求不好在客户端实现。2014 年 Rashid 决定继续重写 Kibana，所以 Kibana3 之后的版本 Kibana4 是完全用 NodeJS 重写的新版。

也是大约在 2014 年 Torkel Ödegaard 注意到 Kibana3 项目，他希望将 Kibana 转变成一个时间序列和以图（Graph）为中心的仪表盘工具并且他有一些自己的设计思路，于是就开辟了一个新的项目。Grafana 的名称正是取自 Graph + Kibana。

Kibana 本身历经多次重写，功能特性也越来越丰富，此时的 Kibana 已不是一个简单的监控平台，而是一个实时的数据可视化分析平台。同作为业内知名的日志监控工具，两者确实各有千秋，功能也存在不相交的差异化部分，没有一方完全超越对方。如果要做技术选型，得在具体需求的基础上做决策。

从 Kibana 的发展历程我们也可以看出，背后支持 Rashid Khan 不停重写改进项目的力量，恐怕不只是 Elastic 公司的重视。更重要的是社区有长期保持活跃，并且有稳定的需求。也正是因为需求不断升级与特化，才会后来诞生了 Grafana，并且两者都能发展得很好。
